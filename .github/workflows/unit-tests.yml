name: Unit tests

on:
  workflow_call:
    inputs:
      cmake-args:
        description: Arguments to pass to cmake
        type: string
        required: false
jobs:
  run:
    strategy:
      matrix:
        platform: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.platform }}

    steps:
      - name: Check out reactor-c repository
        uses: actions/checkout@v2

      - name: Build and run unit tests ${{ inputs.cmake-args }} (linux)
        run: |
          mkdir build
          cd build
          cmake .. ${{ inputs.cmake-args }}
          cmake --build .
          sudo make test
        if: matrix.platform == 'ubuntu-latest'
      - name: Build and run unit tests ${{ inputs.cmake-args }} (macos/win)
        run: |
          mkdir build
          cd build
          cmake .. ${{ inputs.cmake-args }}
          cmake --build .
          make test
        if: matrix.platform != 'ubuntu-latest'
      - name: Run RTI unit tests
        run: |
          cd core/federated/RTI
          mkdir build
          cd build
          cmake ..
          cmake --build .
          ctest
        if: matrix.platform == 'ubuntu-latest' || matrix.platform == 'macos-latest'
          
